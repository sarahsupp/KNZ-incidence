---
title: "EAGER-Birds"
author: "Maya Parker-Smith"
date: "2023-05-01"
output: html_document
 smart: no
    theme: flatly
    float: yes
    css: "style.css"    
editor_options: 
  chunk_output_type: console
mainfont: Arial
mathfont: Arial
fontsize: 12pt
---

```{r setup, include=FALSE}
## Clear environment 
rm(list=ls())


##Libraries
library(tidyverse)
library(cowplot)
library(bbmle)
library(lmerTest)
library(car)
library(readxl)
library(multcomp)
library(readr)
library(incidence)
library(vegan)
library(goeveg)
library(randtests)
library(reshape2)
library(psych)


```



## Bird Sampling
This section is dedicated to cleaning the bird-sampling dataset. Data was collected from 1981 to 2009. Watersheds that are supposedly included: N4B, N4D, 4A, N1B, 1D, R20A, R1B, 20C, 20B, N20B. Censuses are conducted two times during the year: during the first two weeks of January as
a measure of wintering populations, and during the first two weeks of June as a measure of
breeding populations.

Author: Alice Boyle

ZIP file: knb-lter-knz.26.12

Data code: CBP01

File(s): CBP011.csv

Summary of All Changes Up to 1993: 
1981: Transects were as presently located except no transect in N20B and there were transects in  N20C (now N01A), N20D (now part of N01B), N01C (now N02B), N01D (now part of N01B), and N04C (now N04B). 
1982: Transects in N20C (N01A) and N01C (N02B) were dropped, N20D was maintained in what is now N01B. N01D became the second transect in what is now N01B, and N04C transect was maintained in what is now N04B. N20B was added. 
1990: 004d became SA and transect was dropped.


```{r}
#Read in and view bird data
birds_raw <- read_csv("Datasets_EAGER/Birds/knb-lter-knz.26.12/CBP011.csv")
watershed_info <- read_excel("Datasets_EAGER/Other/Watershed Info.xlsx")
View(birds_raw)


#Changing classifications and names of columns
birds <- birds_raw %>% mutate(RECMONTH = factor(RECMONTH),
                          RECDAY = factor(RECDAY),
                          SEASON = factor(SEASON),
                          TRANSNUM = factor(TRANSNUM),
                          SPECNAME = factor(SPECNAME),
                          AOUCODE = factor(AOUCODE),
                          COMMONNAME = factor(COMMONNAME),
                          DISTANCE = as.numeric(DISTANCE),
                          COUNT = as.numeric(COUNT),
                          SEX = factor(SEX),
                          STATUS = factor(STATUS),
                          COMMENTS = as.character(COMMENTS))


birds <- birds %>% rename("Watershed_name" = "WATERSHED",
                          "Datacode" = "DATACODE",
                          "Recyear" = "RECYEAR",
                          "Recmonth" = "RECMONTH",
                          "Recday" = "RECDAY",
                          "Season" = "SEASON",
                          "Transect" = "TRANSNUM",
                          "Observation_number" = "OBSNUM",
                          "Species" = "SPECNAME",
                          "AOU_code" = "AOUCODE",
                          "Common_name" = "COMMONNAME",
                          "Distance" = "DISTANCE",
                          "Count" = "COUNT",
                          "Sex" = "SEX",
                          "Status" = "STATUS",
                          "Comments" = "COMMENTS",
                          "Time" = "TIME",
                          "Duration" = "DURATION",
                          "Observer" = "OBSERVER")


birds$Watershed_name <- dplyr::recode(birds$Watershed_name,
                                       "N04D" = "N4D",
                                       "N04B" = "N4B",
                                       "004B" = "4B",
                                       "004A" = "4A",
                                       "004D" = "4D",
                                       "N01B" = "N1B",
                                       "001D" = "1D",
                                       "R20A" = "R20A",
                                       "R01B" = "R1B",
                                       "020C" = "20C",
                                       "020B" = "20B",
                                       "L00A" = "LA",
                                       "S00A" = "SA",
                                       "G00A" = "GA",
                                       "N20B" = "N20B")



#Joining the watershed_info dataset with the actual birds dataset
birds1 <- left_join(birds, watershed_info, by = "Watershed_name")

birds1 <- birds1 %>% mutate(Fire_interval = factor(Fire_interval),
                                                    Burn_season = factor(Burn_season),
                                                    Grazing = factor(Grazing))


#Changing the order of the fire_interval and grazing treatments for graphing reasons later on
birds1$Fire_interval <- factor(birds1$Fire_interval, 
                               levels = c("1_year", "4_years", "20_years"))

birds1$Grazing <- factor(birds1$Grazing,
                         levels = c("Ungrazed", "Bison"))


#I need to separate the dataset from 1992 onwards. 
birds2 <- birds1 %>% subset(.$Recyear >= 1992)
birds2 <- birds2 %>% mutate(Recyear = factor(Recyear))


#Removing watersheds and transects I won't use for further analysis
birds3 <-  birds2 %>% subset(!(Watershed_name %in% c("4D", "R20A",
                                                     "R1B", "LA",
                                                     "GA", "SA")))

birds3 <-  birds3 %>% subset(Transect != "10")

#Also removing observations that are just "none"
birds3 <-  birds3 %>% subset(AOU_code != "NONE")
birds3 <-  birds3 %>% subset(AOU_code != "VOID")
birds3 <-  birds3 %>% subset(AOU_code != "UNSP")
birds3 <-  birds3 %>% subset(AOU_code != "UNEM")
birds3$AOU_code <- dplyr::recode(birds3$AOU_code,
                                "eawp" = "EAWP")


length(unique(birds3$Species))
length(unique(birds3$AOU_code))

spp_grouped <- birds3 %>% group_by(Species, AOU_code, Common_name) %>% summarise(total_count=n(),.groups = 'drop')
spp_grouped1 <- spp_grouped[order(spp_grouped$AOU_code),]

ssp_grouped2 <- birds3 %>% group_by(Watershed_name, AOU_code) %>% summarize(total_count=n(),.groups='drop')



```


```{r}

#Selecting the columns I want for further analysis 
birds3_short <- birds3 %>% group_by(Recyear, Watershed_name, Fire_interval, Grazing, AOU_code) %>% 
  reframe(Count = sum(Count))



#Pivoting the the dataset wider, so that each species is its own column
birds_wide <- birds3_short %>% 
  pivot_wider(names_from = "AOU_code", values_from = "Count", 
              values_fn = function(x) paste(sum(x)))


#Making an environment table to add back onto the presence/absence data later
birds_env <- birds_wide[, 1:4]


#Standardizing by presence/absence
decostand_pa_birds <- decostand(birds_wide[, -c(1:4)], "pa", na.rm = FALSE)
decostand_pa_birds[is.na(decostand_pa_birds)] <- 0

#adding the presence/absence dataset back with the enviornment dataset
birds_wide2 <- decostand_pa_birds %>% add_column(birds_env, .before = "BHCO")





#Pivoting the presence/absence back to a longer format

birds_long <- birds_wide2 %>% pivot_longer(cols = 5:86,
                                           names_to = "AOU_code",
                                           values_to = "Presence")

birds_long <- birds_long %>% mutate(AOU_code = factor(AOU_code))
birds_long <- birds_long %>% mutate(Watershed_name = factor(Watershed_name))

```


```{r}
unique(birds3$Watershed_name)


birds_4 <- birds3 %>% subset(Watershed_name %in% c("4A", "4B"))
birds_4 <- birds_4 %>% group_by(Watershed_name, Fire_interval, Grazing, AOU_code) %>% 
  reframe(Total = sum(Count))


birds_4wide <- birds_4 %>% 
  pivot_wider(names_from = "AOU_code", values_from = "Total", 
              values_fn = function(x) paste(sum(x)))

birds_4wide_short <- birds_4wide[, -c(1:3)]
birds_4wide_short <- birds_4wide_short %>% mutate_if(is.character, as.numeric)
birds_4wide_short[is.na(birds_4wide_short)] <- 0

sum(apply(birds_4wide_short, 2, function(x) abs(max(x)-min(x)))) / sum(rowSums(birds_4wide_short))




birds_N4 <- birds3 %>% subset(Watershed_name %in% c("N4B", "N4D"))
birds_N4 <- birds_N4 %>% group_by(Watershed_name, Fire_interval, Grazing, AOU_code) %>% 
  reframe(Total = sum(Count))


birds_N4wide <- birds_N4 %>% 
  pivot_wider(names_from = "AOU_code", values_from = "Total", 
              values_fn = function(x) paste(sum(x)))

birds_N4wide_short <- birds_N4wide[, -c(1:3)]
birds_N4wide_short <- birds_N4wide_short %>% mutate_if(is.character, as.numeric)
birds_N4wide_short[is.na(birds_N4wide_short)] <- 0

sum(apply(birds_N4wide_short, 2, function(x) abs(max(x)-min(x)))) / sum(rowSums(birds_N4wide_short))



birds_20 <- birds3 %>% subset(Watershed_name %in% c("20B", "20C"))
birds_20 <- birds_20 %>% group_by(Watershed_name, Fire_interval, Grazing, AOU_code) %>% 
  reframe(Total = sum(Count))


birds_20wide <- birds_20 %>% 
  pivot_wider(names_from = "AOU_code", values_from = "Total", 
              values_fn = function(x) paste(sum(x)))

birds_20wide_short <- birds_20wide[, -c(1:3)]
birds_20wide_short <- birds_20wide_short %>% mutate_if(is.character, as.numeric)
birds_20wide_short[is.na(birds_20wide_short)] <- 0

sum(apply(birds_20wide_short, 2, function(x) abs(max(x)-min(x)))) / sum(rowSums(birds_20wide_short))

```


```{r}
##Creating a Bray-Curtis dissimilarity matrix for the watershed

birds4 <- birds3 %>% group_by(Watershed_name, Fire_interval, Grazing, AOU_code) %>% 
  reframe(Total = sum(Count))


birds4_wide <- birds4 %>% 
  pivot_wider(names_from = "AOU_code", values_from = "Total", 
              values_fn = function(x) paste(sum(x)))


birds4_wide_env <- birds4_wide[, c(1:3)]
birds4_wide1 <- birds4_wide[, -c(1:3)]
birds4_wide1 <- birds4_wide1 %>% mutate_if(is.character, as.numeric)
birds4_wide1[is.na(birds4_wide1)] <- 0

diss_matrix <- vegdist(birds4_wide1, method = "bray")

```


```{r}

#Using the wide dataset to calculate species incidence?
birds_years_wide <- birds_long %>% pivot_wider(names_from = factor("Recyear"), values_from = "Presence")

birds_years_wide <- birds_years_wide %>% mutate(Total_Persistence = 
                                                  rowSums(birds_years_wide[, 5:22]))


view(birds_years_wide)
birds_years_wide <- birds_years_wide %>% mutate(Persistence = (Total_Persistence/18))

birds_years_wide %>% ggplot(aes(x = Persistence)) + geom_histogram(binwidth = 0.1)


birds_long3 <- pivot_longer(birds_years_wide, cols = 5:22,
                     names_to = "Recyear",
                     values_to = "Presence")

birds_long3 <- birds_long3 %>% mutate(Recyear = factor(Recyear))

birds_long4 <- birds_long3 %>% subset(Persistence != 0)

birds_long4 %>% ggplot(aes(x = Recyear, y = factor(Presence), fill = factor(Presence))) + 
  geom_tile() + 
  facet_grid(Species~Grazing~Fire_interval) +
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=45, hjust=1, size =7),
        axis.text.y = element_text(size=7),
        strip.text.y.left = element_text(angle = 0)) +
  scale_fill_manual(values = c("white", "black")) 

 birds_long4 %>%  ggplot(aes(Recyear, factor(Presence), fill = factor(Presence))) +
  geom_tile(color = "gray30") +
   facet_grid(Species~Grazing~Fire_interval, switch = "y") +
   theme(text = element_text(size=7),
        axis.text.x = element_text(angle=45, hjust=1, size =7),
        axis.text.y = element_text(size=7),
        strip.text.y.left = element_text(angle = 0)) +
   coord_equal() +
  scale_fill_manual(values = c("white", "black"), guide = "none") +
  theme_minimal(base_size = 16)


```

```{r}

birds_cont <- birds_long3 
birds_cont <- birds_cont %>% mutate(Presence_cont = NA,
                                    Early_late = NA,
                                    Presence = factor(Presence))




 for(j in 1:nrow(birds_cont)){
   if (birds_cont[j,8] == "1"){birds_cont[j,9] <- "Present"}
   if (birds_cont[j,8] == "0"){birds_cont[j,9] <- "Absent"}
 } 

for(i in 1:nrow(birds_cont)){
   if (birds_cont[i,7] == "1992"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1993"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1994"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1995"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1996"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1997"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1998"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "1999"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "2000"){birds_cont[i,10] <- "Early"}
   if (birds_cont[i,7] == "2001"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2002"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2003"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2004"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2005"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2006"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2007"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2008"){birds_cont[i,10] <- "Late"}
   if (birds_cont[i,7] == "2009"){birds_cont[i,10] <- "Late"}
}


unique(birds_cont$Early_late)



birds_cont <- birds_cont %>% mutate(Presence_cont = factor(Presence_cont),
                                    Early_late = factor(Early_late))

summary_tbl <- birds_cont %>%
  group_by(AOU_code, Watershed_name, Fire_interval, Grazing, Persistence)%>%
    dplyr::count(Presence_cont, Early_late)

summary_tbl <- summary_tbl %>% unite("Species_Watershed", AOU_code:Watershed_name, sep = "_") 
summary_tbl <- summary_tbl %>% mutate(Species_Watershed = factor(Species_Watershed))

contabs <- xtabs(n ~ Presence_cont + Early_late + Species_Watershed, summary_tbl)
chisqtests <- apply(contabs, 3, chisq.test)

chisq_p.values <- tibble(names(chisqtests), do.call(rbind,lapply(chisqtests,function(v){v$p.value})))

chisq_p.values <- chisq_p.values %>% rename("chisq_p.values" = "do.call(...)",
                                            "Species_Watershed" = "names(chisqtests)")
chisq_p.values <- chisq_p.values %>% mutate(Species_Watershed = factor(Species_Watershed))




birds_long4 <- birds_long3 %>% 
  group_by(Recyear, AOU_code, Watershed_name, Persistence) %>% reframe(Presence = Presence)

birds_long4 <- birds_long4 %>% unite("Species_Watershed", AOU_code:Watershed_name, sep = "_")

grouped4 <- birds_long4 %>% group_by(Recyear, Species_Watershed) %>% reframe(Presence = Presence)


presence.tabs <- xtabs(Presence ~ Recyear + Species_Watershed, birds_long4)
runstests <- apply(presence.tabs, 2, runs.test)
runstest_p.values <- tibble(names(runstests), do.call(rbind,lapply(runstests,function(v){v$p.value})))
runstest_p.values <- runstest_p.values %>% rename("runstest_p.values" = "do.call(...)",
                                                  "Species_Watershed" = "names(runstests)")
runstest_p.values <- runstest_p.values %>% mutate(Species_Watershed = factor(Species_Watershed))


merged_p.values <- merge(chisq_p.values,runstest_p.values, by = "Species_Watershed", all = TRUE)




```


```{r}

merged_p.values2 <- merged_p.values %>% mutate(Incidence_change = NA,
                                          Sequential_patterns = NA)
group <- summary_tbl %>% dplyr::select(Species_Watershed, Fire_interval, Grazing, Persistence) %>% distinct()
merged_p.values2 <- merge(merged_p.values2, group, by = "Species_Watershed")

for (k in 1:nrow(merged_p.values2)){
  if (is.nan(merged_p.values2$chisq_p.values[k])) {merged_p.values2$chisq_p.values[k] <- 2}
  if (is.na(merged_p.values2$runstest_p.values[k])) {merged_p.values2$runstest_p.values[k] <- 2}
}

merged_p.values3 <- merged_p.values2

for (kk in 1:nrow(merged_p.values3)){
  if (merged_p.values3[kk, 2] == 2){merged_p.values3[kk, 4] <- "-"}
  if (merged_p.values3[kk, 2] <= 0.05){merged_p.values3[kk, 4] <- "Significant"}
  if (merged_p.values3[kk, 2] > 0.05 & merged_p.values3[kk, 2] < 2){merged_p.values3[kk, 4] <- "NS"}
  if (merged_p.values3[kk, 3] == 2){merged_p.values3[kk, 5] <- "-"}
  if (merged_p.values3[kk, 3] <= 0.05){merged_p.values3[kk, 5] <- "Significant"}
  if (merged_p.values3[kk, 3] > 0.05 & merged_p.values3[kk, 3] < 2){merged_p.values3[kk, 5] <- "NS"}
}


merged_p.values4 <- merged_p.values3 %>% mutate(Classification = NA)

for (jj in 1:nrow(merged_p.values4)){
  if (merged_p.values4[jj, 4] == "-" & merged_p.values4[jj, 5] == "-" & merged_p.values4[jj,8] == 0){merged_p.values4[jj, 9] <- "No_change.always_absent"}
  if (merged_p.values4[jj, 4] == "-" & merged_p.values4[jj, 5] == "-" & merged_p.values4[jj,8] == 1){merged_p.values4[jj, 9] <- "No_change.always_present"}
  if (merged_p.values4[jj, 4] == "NS" & merged_p.values4[jj, 5] == "NS"){merged_p.values4[jj, 9] <- "Random"}
  if (merged_p.values4[jj, 4] == "NS" & merged_p.values4[jj, 5] == "Significant"){merged_p.values4[jj, 9] <- "Recurrent"}
  if (merged_p.values4[jj, 4] == "Significant" & merged_p.values4[jj, 5] == "-"){merged_p.values4[jj, 9] <- "Significant"}
  if (merged_p.values4[jj, 4] == "NS" & merged_p.values4[jj, 5] == "-"){merged_p.values4[jj, 9] <- "Random"}
}
  

merged_p.values5 <- merged_p.values4

for (aa in 1:nrow(merged_p.values5)){
  if (merged_p.values5[aa, 1] == "BARS_4A"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "BGGN_N20B"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "BGGN_N4D"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "EAKI_N20B"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "EAKI_N4D"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "EATO_4A"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "EATO_N4D"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "INBU_20B"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "INBU_N4D"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "RNEP_1D"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "RSTO_N20B"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "RSTO_N4D"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "RWBL_4A"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "EATO_N20B"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "EATO_20B"){merged_p.values5[aa, 9] <- "Increasing"}
  if (merged_p.values5[aa, 1] == "FISP_4B"){merged_p.values5[aa, 9] <- "Decreasing"}
  if (merged_p.values5[aa, 1] == "INBU_N20B"){merged_p.values5[aa, 9] <- "Increasing"}
}

for (ii in 1:nrow(merged_p.values5)){
  if (merged_p.values5[ii, 2] == 2) {merged_p.values5$chisq_p.values[ii] <- NA}
  if (merged_p.values5[ii, 3] == 2) {merged_p.values5$runstest_p.values[ii] <- NA}
}


check <- merged_p.values4 %>% subset(Classification == "Significant")
is.na(merged_p.values5$Classification)

birds_years_wide3 <- birds_years_wide %>% unite("Species_Watershed", c(AOU_code, Watershed_name), sep = "_")

birds_check <- birds_long4 %>% subset(Species_Watershed %in% c("BARS_4A", "BGGN_N20B", "BGGN_N4D", "EAKI_N20B", "EAKI_N4D", "EATO_4A", "EATO_N4D", "INBU_20B", "INBU_N4D", "RNEP_1D", "RSTO_N20B", "RSTO_N4D", "RWBL_4A", "EATO_20B", "EATO_N20B", "FISP_4B", "INBU_N20B"))

birds_check %>% ggplot(aes(x = Recyear, y = factor(Presence), fill = factor(Presence))) + 
  geom_tile(width = .9, height = .9) + 
  facet_wrap(.~Species_Watershed, switch = "y")
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=45, hjust=1, size =7),
        axis.text.y = element_text(size=7),
        strip.text.y.left = element_text(angle = 0)) +
  labs(x = "Year", y = "Presence", fill = "Presence")

grouped_idk <- merged_p.values5 %>% group_by(Classification, Fire_interval, Grazing) %>% summarize(total_count=n(),.groups = 'drop')

grouped_idk %>% ggplot(aes(x = Classification, y = total_count, fill = Classification)) + geom_col() +
  facet_wrap(Fire_interval~Grazing)

```




```{r}


birds_long5 <- left_join(birds_long4, merged_p.values5)
birds_long6 <- birds_long5 %>% separate(Species_Watershed, c("Species", "Watershed"), "_")
birds_long6 <- birds_long6 %>% mutate(Species = factor(Species), Watershed = factor(Watershed))

birds_long6$Classification <- factor(birds_long6$Classification, 
                               levels = c("No_change.always_absent", "No_change.always_present", "Random", "Increasing", "Decreasing"))

birds_long6 %>% ggplot(aes(x = Recyear, y = factor(Presence), fill = factor(Presence))) + 
  geom_tile(width = .6, height = .6) + 
  facet_grid(Species~Watershed, switch = "y") +
  theme(text = element_text(size=5),
        axis.text.x = element_text(angle=45, hjust=1, size =5),
        axis.text.y = element_text(size=5),
        strip.text.y.left = element_text(angle = 0)) +
  scale_fill_manual(values = c("NA", "black")) +
  labs(x = "Year", y = "Presence", fill = "Presence")

birds_long7 <- birds_long6
birds_long7$Presence[birds_long7$Presence == 0] <- NA
birds_long7 <- birds_long7 %>% mutate(Recyear = as.character(Recyear))
birds_long7 <- birds_long7 %>% mutate(Recyear = as.numeric(Recyear))

unique(birds_long7$Watershed)
birds_long7$Watershed <- factor(birds_long7$Watershed,
                                levels = c("1D", "N1B", "4A", 
                                           "4B", "N4B", "N4D", 
                                           "20B", "N20B"))

birds_long7 %>% ggplot(aes(x = Recyear, y = Presence, fill = Classification)) + 
  geom_tile(width = .6, height = .6) + 
  facet_grid(Species~Watershed, switch = "y") +
  theme(text = element_text(size=7),
        axis.text.x = element_text(angle=45, hjust=1, size =7),
        axis.text.y = element_text(size=5),
        strip.text.y.left = element_text(angle = 0, size = 3),
        strip.text.x.top = element_text(size = 7)) +
  scale_fill_manual(values = c("NA", "black", "dodgerblue2", "green3", "indianred3")) +
  labs(x = "Year", y = "Presence", fill = "Classification")


birds_long7_sig <- birds_long7 %>% subset(Species %in% c("BARS", "BGGN", "EAKI", "EATO", "INBU", "RNEP", "RSTO", "RWBL", "FISP"))

birds_long7_sig %>% ggplot(aes(x = Recyear, y = Presence, fill = Classification)) + 
  geom_tile(width = .6, height = .6) + 
  facet_grid(Watershed~Species, switch = "y", scales = "free_y", space = "free_y") +
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=45, hjust=1, size =7),
        axis.text.y = element_text(size=7),
        strip.text.y.left = element_text(angle = 0)) +
  scale_fill_manual(values = c("NA", "black", "dodgerblue2", "green3", "indianred3")) +
  geom_vline(xintercept = 2000.5, linetype= 3) +
  labs(x = "Year", y = "Presence") 

```



