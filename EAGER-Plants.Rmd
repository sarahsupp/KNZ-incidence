---
title: "KNZ-incidence: Cleaning Biotic Datasets"
author: "Maya Parker-Smith"
date: "2023-05-15"
output: html_document
 smart: no
    theme: flatly
    float: yes
    css: "style.css"    
editor_options: 
  chunk_output_type: console
mainfont: Arial
mathfont: Arial
fontsize: 12pt
---

```{r setup, include=FALSE}
## Clear environment 
rm(list=ls())


##Libraries
library(tidyverse)
library(cowplot)
library(bbmle)
library(lmerTest)
library(car)
library(readxl)
library(multcomp)
library(readr)
library(incidence)
library(vegan)
library(goeveg)
library(randtests)
library(reshape2)
```

##Plant Species Composition
This section is dedicated to cleaning the plant species composition/cover dataset. Data was collected from 1983 to 2022. Watersheds that are included: FA, SuB, N4A, R1A, 2D, WB, N20B, 1D, N1A, R1B, SpA, SpB, WA, 20B, 4A, 4F, SuA, N1B, N20A, N4D.

Author: David Hartnett, Scott Collins, Zak Ratajczak

ZIP file: knb.lter.knz.69.21

Data code: PVC02

File(s): PVC021.csv
 Pasture c01b was called Texas Hog (thp) in 2009. 
Vegetation species composition from 1983: The transects were permanently laid out in the current format of 4 transects (A-D), each with 5 plots. 
Transect E only occurred on watershed N20B florence in 1986 and 1987. This transect is the same as the current transect D for this watershed and soil type. 
The old transect D was abandoned in 1987 prior to bison reintroduction. 
Seven cover classes were used to estimate species canopy coverage. 1 - 0-1% cover; 2 - 2-5% cover; 3 - 5-25% cover; 4 - 25-50% cover; 5 - 50-75%; 6 - 75-95% cover; 7 - 95-100% cover. (Note: for the watershed r20b, no data were collected in the transect A and B in the fall of 2011 due to wildfire occurred.) 
Transect 'E' occurred only on the N20b florence site in 1986 and 1987 and was renamed the new 'transect' in 1988. 
The old 'D' transect was sampled from 1983 to 1987 and then abandoned when the bison fence was constructed. 
Thus, plots d1-d5 from 1983-1987 are NOT the same d1-d5 plots in subsequent years.

```{r}

plant_comp_raw <- read_csv("Datasets_EAGER/Plants/knb-lter-knz.69.21_SpeciesComposition/PVC021.csv")

watershed_info <- read_excel("Datasets_EAGER/Other/Watershed Info.xlsx")

unique(plant_comp_raw$WaterShed)
view(plant_comp_raw)

plant_comp <- plant_comp_raw %>% mutate(RecType = factor(RecType),
                                        RecMonth = factor(RecMonth),
                                        RecDay = factor(RecDay),
                                        WaterShed = factor(WaterShed),
                                        SoilType = factor(SoilType),
                                        Transect = factor(Transect),
                                        Plot = factor(Plot),
                                        SpeCode = factor(SpeCode))

#Combining the genus and species column and creating a new column. 
plant_comp1 <- add_column(unite(plant_comp, "Genus_spp", AB_genus:AB_species, sep = "_"))

unique(plant_comp1$WaterShed)


plant_comp1$WaterShed <- dplyr::recode(plant_comp1$WaterShed,
                                "001c" = "1C",
                                "001d" = "1D",
                                "004b" = "4B",
                                "020b" = "20B",
                                "n01b" = "N1B",
                                "n04d" = "N4D",
                                "n20b" = "N20B",
                                "002c" = "2C",
                                "002d" = "2D",
                                "004a" = "4A",
                                "004f" = "4F",
                                "n04a" = "N4A",
                                "n20a" = "N20A",
                                "020d" = "20D",
                                "n01a" = "N1A",
                                "00wb" = "WB",
                                "0spa" = "SpA",
                                "0spb" = "SpB",
                                "00fa" = "FA",
                                "00fb" = "FB",
                                "00wa" = "WA",
                                "0sua" = "SuA",
                                "0sub" = "SuB",
                                "001a" = "1A",
                                "020a" = "20A",
                                "r01a" = "R1A",
                                "r01b" = "R1B",
                                "r20a" = "R20A",
                                "r20b" = "R20B",
                                "n02a" = "N2A",
                                "n02b" = "N2B")

unique(plant_comp1$WaterShed)

plant_comp1 <- plant_comp1 %>% rename("Watershed_name" = "WaterShed",
                              "Recyear" = "RecYear",
                              "Recmonth" = "RecMonth",
                              "Recday" = "RecDay")


plant_comp2 <- plant_comp1
plant_comp2 <- plant_comp2 %>% subset(.$Recyear >= 1992)
plant_comp2 <- plant_comp2 %>% mutate(Recyear = factor(Recyear))


#Removing watersheds and transects I won't use for further analysis
plant_comp3 <- plant_comp2

plant_comp3 <- plant_comp3 %>%
  subset(Watershed_name %in% c("1A", "1C", "1D",
                              "4A", "4B", "4F",
                              "20A", "20B", "20D",
                              "N1A", "N1B",
                              "N4A", "N4D",
                              "N20A", "N20B")) 

plant_comp3 <- left_join(plant_comp3, watershed_info, by = "Watershed_name")

length(unique(plant_comp3$SpeCode))

unique(plant_comp3$SpeCode)


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
